[TOC]

# MindSpore 内容整理

----

在看MindSpore 中的相关介绍的内容中，发现实际上其有很多的特性，也有很多值得探索的地方，当然，该框架也有很多继承了tensorflow 和 pytorch 等的现有框架。因此在这里记录一下相关的特性，来加深对于MindSpore框架的理解，同时也通过与其它框架做对比，来进一步了解各类深度学习框架并在后续做一些相关的总结。

在这里，再附一个MindSpore的框架图

![image-20200625080405609](https://i.loli.net/2020/06/25/pBM7xE2dakr1TI3.png)

可以看到，可以将MindSpore深度学习框架主要分成3 个部分（或者再加上一个auto tensor , 在图中没有展示的部分） ，其中主要为Mind Expression(ME), Graph Engine(GE) 和后端运行时(runtime)

**关于对于深度学习框架的认知，推荐这篇文章**：[如何欣赏一个深度学习框架](https://zhuanlan.zhihu.com/p/117269565)。

从这篇文章中，也可以找到很多值得去对于MindSpore进行探讨的点，这里就先不一一说明了。

## MindSpore 特性

### Auto Parallel

自动化并行，MindSpore框架中的一大亮点就是其在文档中所强调的一个自动并行的训练能力，相比于其它的例如tensorflow 和 pytorch 等深度学习框架，这种自动并行的特性倒是第一次提出。 关于其的相关说明，可以参考[MindSpore分布式自动并行训练](https://www.bilibili.com/video/BV1jK4y1b7Ng)。

在深度学习领域存在多种并行的范式，包括数据并行，模型并行和混合并行；数据并行实现较为容易的，当时对于模型并行和混合并行，其它的深度学习框架目前都没有很好的支持。

对于MindSpore中所支持的并行而言，其不仅是数据并行，其主要强调其自动并行的能力，即从众多的并行可能性中搜寻一种最优的并行执行方法，将部分算子进行自动拆分从而达到一个比较好的并行效果。 在MindSpore里面用户可以通过`set_auto_parallel_context`这个接口来指定不同的并行策略。

### 即时编译（JIT）

在MindSpore的ME部分中，其主要采用模块化方式描述网络，采用即时编译来将Python描述的网络静态编译为计算图，提高网络执行效率。 

### SCT自动微分

关于自动微分技术 ，目前主要有三种自动微分技术：

1. 以tensorflow 为代表的基于静态数据流图的转换，可利用静态编译技术对网络进行性能优化，但受制于数据流图的表达形式，不能灵活表达控制流
2. 以pytorch 为代表的基于动态图的转换，虽然可以使用户可以灵活的使用控制流。而其缺点是运行时开销高，且不能运行静态编译技术对计算图进行性能优化
3. 基于源码转换的通用数据微分，也就是MindSpore采用的技术，可以做到支持全部主要的语法结构（闭包，函数调用，条件跳转，循环，递归等）

### 全场景部署

ME编译得到的计算图是device 无关的， 可以在Ascend、CPU 及 GPU等多种不同的后端上进行训练和推理。对于MindSpore框架而言，其易用性不仅体现在模型开发上，还包括对于模型的部署过程，其提供一次训练，多次部署的相应功能。 

### 整图下沉

MindSpore中的整图下沉特性也是一个非常有意思的特性，其主要得益于晟腾芯片的创新架构（达芬奇架构）， 在GE中针对高性能训练场景使用整图下沉设计，即图优化的结果一次下发到芯片，无需在Host上通过图Runtime 分发op，减少了交互开销。MindSpore GE的图优化是业界第一个支持NPU的开源图引擎。

### 子图异步

GE图拆分基于引擎代价模型自动映射图节点，实现不同子图之间全异步，比如log/metric处理和前向计算全异步，数据处理与前向/反向计算全异步，反向计算与梯度聚合全异步等。

### 支持晟腾芯片

这实际上也是MindSpore框架的一个重要的特性和价值，现有的深度学习框架，如果想要迁移到新的AI处理器，例如华为的晟腾Ascend处理器上，有相应的工作要做。而且，如果tensorflow 或者 pytorch 进行相应的演进（tensorflow -> tf 2 ) ，那么必然导致代码的重新迁移，因为其框架不会主动去支持底层的相应AI加速器，所以对于Ascend芯片的支持，也是一个很重要的特点。

### 模型安全

实现了一套提升训练robustness  的 pipeline ， 这能够使得整个模型的鲁棒性有一个较好的保障。 

### 自动代码生成

MindSpore，为了加速在不同平台的算子开发和验证， 提供了自动代码生成模块，它可以从Python代码中生成目标前向和后向算子。

## MindSpore框架



**当然，上面的内容主要是MindSpore含有的特性，当然要深入了解深度学习框架，还是需要一个综合性的体系，那么下面主要的部分就在于以深度学习框架的发展来了解应该有的基本属性。** 



